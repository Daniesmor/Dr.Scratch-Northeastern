{% load i18n %}
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="Analyze your Scratch projects to assess your Computational Thinking skills">
    <meta name="keywords" content="Stamp, Startup, Multipurpose, Bootstrap, Landing page, Template, Registration, Landing">
    <meta name="author" content="Programamos URJC Libresoft FECyT">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../static/app/content/scratchblocks2.css">
    <!-- <script src="../../static/app/scripts/bootstrap-modal.js"></script> -->
    <script src="../../static/app/scripts/translations.js"></script>
    <!-- <script src="../../static/app/scripts/bootstrap.js"></script> -->
    <link rel="stylesheet" href="../../static/app/content/bootstrap-tour.css">
    <script src="../../static/app/scripts/bootstrap.min.js"></script>
    <script src="../../static/app/scripts/bootstrap-tour.js"></script>
    <script src="../../static/app/scripts/googleAnalytics.js"></script>
    <script src="../../static/app/scripts/scratchblocks-v3.4-min.js"></script>


    <!-- SITE TITLE -->
    <title>Dr. Scratch</title>


    <link rel="stylesheet" href="/static/app/content/style.css">
    <!-- =========================
     FAV AND TOUCH ICONS AND FONT
    ============================== -->
    <link rel="icon" href="/static/app/images/favicon.ico">
    <link rel="stylesheet" href="static/app/icons/icons.css">
    <link type="text/css" rel="stylesheet" href="/static/app/content/css_002.css">
    <link type="text/css" rel="stylesheet" href="/static/app/content/css.css">
    <!-- =========================
     STYLESHEETS
    ============================== -->
    <!-- BOOTSTRAP AND ANIMATION -->
    <link rel="stylesheet" href="/static/app/content/bootstrap.min.css">
    <link rel="stylesheet" href="/static/app/content/animate.css">

    <!-- CAROUSEL AND LIGHTBOX -->
    <link rel="stylesheet" href="../../static/app/content/owl_002.css">
    <link rel="stylesheet" href="../../static/app/content/owl.css">
    <link rel="stylesheet" href="../../static/app/content/nivo-lightbox.css">
    <link rel="stylesheet" href="../../static/app/content/default.css">

    <!-- CUSTOM STYLESHEETS -->
    <link rel="stylesheet" href="../../static/app/content/styles.css">
    <link rel="stylesheet" href="/static/app/content/master.css">
    <!-- RESPONSIVE FIXES -->
    <link rel="stylesheet" href="../../static/app/content/responsive.css">

    <!-- DEFAULT COLOR/ CURRENTLY USING -->
    <link rel="stylesheet" href="../../static/app/content/red.css">

    <script>
    // Instance the tour
    $(document).ready(function(){
        $("#tour").click(function(){
    var tour = new Tour({
      storage: false,
      backdrop: true,
      steps: [
      {
        element: "#stepone",
        title: "{% trans 'Score' %}",
        content: "{% trans 'This section shows the total score.' %}"
      },
      {
        element: "#steptwo",
        title: "{% trans 'Bad habits in programming' %}",
        content:"{% trans 'If you correct your bad habits in programming, you will avoid problems in the future.'%}"
      },
      {
        element: "#stepthree",
        title: "{% trans 'Certificate' %}",
        content:"{% trans 'Download your certificate!'%}"
      },
      {
        element: "#stepfour",
        title: "{% trans 'Score in detail'%}",
        content: "{% trans 'Here we show the score in each programming skill as well as links to sites that can help you to level up.' %}",
        placement:'left'
      }
    ]});
     tour.init();
    // Initialize the tour


            tour.start();

        });
});
    </script>
    <script>
        window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
    </script>
    <script>
        $(document).ready(function () {
            $('.dropdown').popover();
    });
    </script>
    <script>
        $(document).ready(function() {
            scratchblocks.renderMatching('pre.blocks', {
            style:     'scratch3',   // Optional, defaults to 'scratch2'.
            languages: ['en'], // Optional, defaults to ['en'].
            scale: 0.5,                // Optional, defaults to 1
            });
        })
    </script>
    <script>
        $(document).ready(function () {
            if("{{ dupCode }}" == ""){
                $("#dupCode").attr("data-content","{% trans 'Your project does not have duplicated scripts, good job!' %}");
            }else{
                str = "{{ dupCode }}".split(",");
                for (n in str){

                    if(n == 0){str[n] = str[n].slice(13,-11)}
                    else if(n == str.length-1) { str[n] = str[n].slice(14,-12)}
                    else{
                    str[n] = str[n].slice(14,-11)};
                };
                $("#dupCode").attr("data-content",str.join("\n"));
            }
        });
    </script>
    <script>
    $(document).ready(function(){

    var filename = "{{ filename }}";
    var level = "{{ mastery.points}}/{{ mastery.maxi }}";
    var list =[filename,level];
    $("#certificate").val(list.toString());
    });

    </script>

    <script>
        $(document).ready(function(){
            var isMouseOverPopover = false;
        
            $('.dropdown').popover({
                trigger: 'manual',
                html: true,
                animation: false
            }).on('mouseenter', function () {
                var contentId = $(this).attr('id');
                if (contentId === 'dead-code') {
                    var content = $(this).next('#dead-code-content').html();
                    $(this).attr('data-content', content);
                } else {
                   var _this = this;
                }
                $(this).popover('show');
                $('.popover').on('mouseenter', function () {
                    isMouseOverPopover = true;
                }).on('mouseleave', function () {
                    isMouseOverPopover = false;
                    $(_this).popover('hide');
                });
            }).on('mouseleave', function () {
                var _this = this;
                setTimeout(function () {
                    if (!isMouseOverPopover) {
                        $(_this).popover('hide');
                    }
                }, 100);
            });
        });
        
    </script>

    <style>
        .btn-primary {
            background-color: #1792A4;
        }
        .btn-primary:hover {
            background-color: #4CA8A1;
        }
        .btn-primary:focus {
            background-color: #4CA8A1;
        }
    </style>
    
</head>
<body>
    <!-- TOP BAR -->
<div id="wrap">
    <div class="navbar navbar-inverse bs-docs-nav navbar-fixed-top  sticky-navigation" role="navigation">
        <div class="container">
            <div class="navbar-collapse collapse" id="stamp-navigation">
                    <!-- NAVIGATION LINK -->
                <a class="navbar-brand" href="/">
                    <img src="static/app/images/logo_main.png" alt="">
                </a>
                <ul class="nav navbar-nav navbar-right main-navigation ">
                        <li class="navbar-brand"><a class="navbar-brand pull-right" href="https://twitter.com/DrScratchTool"><span class="icon-social-twitter colored-text"></span></a></li>
                        <li class="navbar-brand"><a class="navbar-brand pull-right" href="mailto:kgblll@gsyc.urjc.es"><span class="icon-basic-mail colored-text"></span></a></li>
                        <li class="navbar-brand"><a class="btn btn-default" id="tour">{% trans "HELP" %}</a></li>
                        <li class="navbar-brand"><a class="navbar-brand pull-right">{% trans "Dr. Scratch(Beta Version)" %}</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /END TOP BAR -->

<div class="container">
    <!-- BODY -->
    <section id="blackboard" class="services col-md-5">
    <!-- POINTS PANEL -->
        <div class="devpanel">

            <div class="panel panel-success" id="devpanel">
                <div class="panel-heading" id="stepone" >
                    <img src="static/app/images/cat.png" class="img-responsive col-md-3">
                    <h2 id="score" class="panel-title dark-text"> <strong>{% trans "Score:" %}</strong> {{ mastery.points }}/{{ mastery.maxi }}
                    <a class="twitter-share-button" data-text="{% blocktrans with points=mastery.points %} I have just obtained {{ points }} points analyzing my project in Dr. Scratch! Beat it! @DrScratchTool {% endblocktrans %}"href="https://twitter.com/share">Tweet</a></h2>
                </div>
                <div class="panel-body">
                    <div class="container col-md-12">
                            {% trans "<h3 class='text-left dark-text'>The level of your project is... <strong> MASTER! </strong></h3>" %}
                            <p class='text-left dark-text'> {% trans "You're the master of the universe!!! " %}</p>
                    </div>

                </div>
                {% if url != "" %}
               <a href="{{ url }}" target="_blank"><span class="glyphicon glyphicon-hand-right"></span>{% trans "Come back to your Scratch project." %}</a>
               {% endif %}
            </div>

        </div>
    <!-- /POINTS PANNEL -->
    
    <!-- HOW TO IMPROVE -->
            <div class="improve">
                <div class="panel panel-success" id="improve">

                 <div id="steptwo">

                    <div class="panel-heading" >
                        <h2 id="score" class="panel-title dark-text">{% trans "Bad habits"%}</h2>
                    </div>
                    <div class="panel-body text-left typ">
                        <a class="glyphicon glyphicon-repeat"/>
                        <a id="bad-smells" data-html="true" class="dropdown" data-toggle="popover" title="{% trans 'Duplicated scripts' %}" 
                        data-content="
                        {% for k, list_duplicate_blocks in duplicateScript.items %}
                            {% if k == 'scripts' %}
                                    {% for list_blocks in list_duplicate_blocks %}
                                        {{ list_blocks }}
                                    {% endfor %}
                            {% endif%}
                        {% endfor %}
                        {% if duplicateScript.number == 0 %}
                            {% trans 'Your project does not have dead code, good job!' %}
                        {% endif %}
                        " data-trigger="manual" href="learn/duplicatedScripts">
                            {{ duplicateScript.number }} {% trans " duplicated scripts." %}
                        </a><br>
                        <a class="glyphicon glyphicon-pencil"/>
                        <a id="bad-smells" data-html="true" class="dropdown" data-toggle="popover" title="{% trans 'Sprite naming' %}" 
                        data-content="
                        {% for value in spriteNaming.sprite %}
                            {{ value }}
                            <br>
                        {% endfor %}
                        {% if spriteNaming.number == 0 %}
                            {% trans 'Your project does not have default sprite naming, good job!' %}
                        {% endif %}
                        " data-trigger="manual" href="learn/spriteNaming"> 
                            {{ spriteNaming.number }} {% trans " sprite naming." %}
                       </a><br>
                       <a class="glyphicon glyphicon-pencil"/> 
                       <a id="bad-smells" data-html="true" class="dropdown" data-toggle="popover" title="{% trans 'Backdrop naming' %}" data-content="
                       {% for value in backdropNaming.backdrop %}
                            {{ value }} <br>
                       {% endfor %}
                       {% if backdropNaming.number == 0 %}
                            {% trans 'Your project does not have default backdrop naming, good job!' %}
                       {% endif %}
                        " data-trigger="manual" href="learn/spriteNaming"> 
                            {{ backdropNaming.number }} {% trans " backdrop naming." %}
                       </a><br>
                        <a class="glyphicon glyphicon-remove-sign"/>
                        <a id="dead-code" data-html="true" class="dropdown" data-toggle="popover" title="{% trans 'Dead code' %}" 
                           data-trigger="manual" href="learn/deadCode"> 
                            {{ deadCode.number }} {% trans " dead code." %}
                        </a>
                        <div id="dead-code-content" class="collapse">
                            <div class="container-fluid">
                                {% for key, value in deadCode.items %}
                                    {% if key != 'deadCode' %}
                                        {% if key != 'number' %}
                                            <b> {{ key }}: </b><br>
                                            {% for dead_block in value %}
                                                <pre class="blocks">
                                                    {{ dead_block }}
                                                </pre>
                                            {% endfor %}
                                            <br>
                                        {% endif%}
                                    {% endif%}
                                {% endfor%}
                                {% if deadCode.number == 0 %}
                                    {% trans 'Your project does not have dead code, good job!' %}
                                {% endif %}
                            </div>
                        </div>

			<!--
                        <a class="glyphicon glyphicon-exclamation-sign"/><a class="dropdown" data-toggle="popover" title="{% trans 'Sprites attributes' %}" data-content=" {% for key,value in initialization.items%}
                        {% if value|length > 0 %}
                        {% if key != 'number' %}
                        {% if initialization.number == 0 %}
                        {% trans 'Your project does not have uninitialized attributes, good job!'%}
                        {% else %}
                        {{ key }}({{ value }})
                        {% endif %}
                        {% endif%}
                        {% endif%}
                        {% endfor%}" data-trigger="hover" href="learn/attrInit"> {{ initialization.number }} {% trans " sprite attributes." %}

</a>
			-->
                    </div>
                    </div>
                    {% if refactor.refactor_list %}
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                            Display all duplicates
                        </button>
                    {% endif %}
                </div>
            </div>
            <div class="improve" >
                <div class="panel panel-success" id="improve">
                    <div id="stepthree">
                        <div class="panel-heading" >
                            <h2 id="score" class="panel-title dark-text">{% trans "Project certificate"%}</h2>
                        </div>
                        <div class="panel-success" style="word-break: break-word;" >
                            <h5>{{ filename }} <form name="form" class="project-form" enctype="multipart/form-data" method="post" action="/download_certificate">
                            {% csrf_token %}
                            <button value="{{ filename }}" name="certificate" type="submit" id ="certificate">{% trans "Download" %}</button>
                          </form></h5>
                        </div>

                    </div>
                </div>

            </div>

            </section>
<!-- /HOW TO IMPROVE -->

  <!-- Score in detail -->
    <div class="col-md-7">
        <section id="dashboard">
            <div class="container-fluid" id="stepfour">
                <div class="row marketing">
                    <div class="jumbotron">
                        <div class="table-responsive">
                            <table class="table tablesorter">
                                <thead>
                                    <tr>
                                    <th><h4>{% trans "Level up" %}</h4></th>
                                    <th class="col-md-5"><h4>{% trans "Level" %}</h4></th>
                                    </tr>
                                </thead>
                                <tbody>
                                
                                
                                {% for key, value in mastery.items %}
                                
                                {% if forloop.counter0|divisibleby:1 %}<tr>{% endif %}
                                {% if key != "points" %}
                                {% if key != "maxi" %}
                                {% if key != "skill_points" %}

                                      <td>
                                        {% if value.0 == value.1 %}
                                        <span class="glyphicon glyphicon-star" id="star"></span>
                                        {% else %}
                                        <img src="static/app/images/little_bulb.png" alt="">
                                        {% endif %}
                                        {% blocktrans %}
                                        <a href="/learn/{{ key }}/">{{ key }}</a>
                                        {% endblocktrans %}
                                      </td>
                                      <td>
                                            {% if value.0 == 0 or value.1 == 0 %}
                                             <div class="progress">
                                                <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="3" style="width: 0%">
                                                    <span><strong>{{ value.0 }}/{{ value.1 }}</strong></span>
                                                </div>
                                             <div>
                                            {% elif value.0 == 1 %}
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="3" style="width: 33%">
                                                    <span><strong>{{ value.0 }}/{{ value.1 }}</strong></span>
                                                </div>
                                             <div>
                                            {% elif value.0 ==  2%}
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="3" style="width: 66%">
                                                    <span><strong>{{ value.0 }}/{{ value.1 }}</strong></span>
                                                </div>
                                            <div>
                                            {% elif value.0 == 3 %}
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="3" style="width: 100%">
                                                    <span><strong>{{ value.0 }}/{{ value.1 }}</strong></span>
                                                </div>
                                             <div>
                                            {% elif value.0 == 4 %}
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="{{ value }}" aria-valuemin="0" aria-valuemax="3" style="width: 100%">
                                                    <span><strong>{{ value.0 }}/{{ value.1 }}</strong></span>
                                                </div>
                                             <div>
                                            {% endif %}
                                       </td>
                                {% endif %}
                                {% endif %}
                                {% endif %}
                                {% if forloop.counter|divisibleby:1 or forloop.last %}
                                </tr>{% endif %}
                 
                                {% endfor %}
                                </tbody>
                             </table>
                        </div>
                      </div>
                    </div>
                </div>
        </section>
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Duplicates</h5>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="card" id="refactorization">
                            {% for refactor_dict in refactor.refactor_list %}
                            <p>
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#originalCollapse{{ forloop.counter }}" aria-expanded="false" aria-controls="originalCollapse{{ forloop.counter }}">
                                    Display Original Blocks!
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#refactoredCollapse{{ forloop.counter }}" aria-expanded="false" aria-controls="refactoredCollapse{{ forloop.counter }}">
                                        Display Solution!
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="collapse" id="originalCollapse{{ forloop.counter }}" data-bs-parent="#refactorization">
                                        <div class="card card-body">
                                            <pre class="blocks">
                                                {{ refactor_dict.original }}
                                            </pre>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="collapse" id="refactoredCollapse{{ forloop.counter }}" data-bs-parent="#refactorization">
                                        <div class="card card-body">
                                            <pre class="blocks">
                                                {{ refactor_dict.refactored }}
                                            </pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>
        <!-- <div class="card" id="refactorization">
            {% for refactor_dict in refactor.refactor_list %}
            <p>
                <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#originalCollapse{{ forloop.counter }}" aria-expanded="false" aria-controls="originalCollapse{{ forloop.counter }}">
                  Display Original Blocks!
                </button>
                <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#refactoredCollapse{{ forloop.counter }}" aria-expanded="false" aria-controls="refactoredCollapse{{ forloop.counter }}">
                    Display Solution!
                  </button>
              </p>
              <div class="collapse" id="originalCollapse{{ forloop.counter }}" data-bs-parent="#refactorization">
                <div class="card card-body">
                    <pre class="blocks">
                        {{ refactor_dict.original }}
                    </pre>
                </div>
              </div>
              <div class="collapse" id="refactoredCollapse{{ forloop.counter }}" data-bs-parent="#refactorization">
                <div class="card card-body">
                    <pre class="blocks">
                        {{ refactor_dict.refactored }}
                    </pre>
                </div>
              </div>
            {% endfor %}
        </div> -->
     </div>
</div>

    <footer class="footer grey-bg">
        <div class="container">
            <p><small>{% trans "© 2019 Dr. Scratch." %} Made with <span style="color: #e25555;">&#9829;</span> by <a href="/collaborators">Dr. Scratch Team</a></small></p>
            <ul class="social-icons">
                <li><a href="https:/twitter.com/drscratchtool"><span class="icon-font-social-twitter transparent-text-dark"></span></a></li>
                <li><a href="https://github.com/AngelaVargas/drscratchv3"><span class="icon-font-social-github transparent-text-dark"></span></a></li>
                <!--<li><a href="mailto:drscratch@gsyc.urjc.es"><span class="icon-font-social-mail transparent-text-dark"></span></a></li>-->
            </ul>
        </div>
    </footer>

</body>
</html>
